<div class="container mt-4">
  <div class="d-flex flex-wrap justify-content-between align-items-center mb-3 gap-3">
    <button class="btn btn-secondary" (click)="toggleAddForm()">
      {{ showAddForm ? 'Cancel' : 'Add Ticket' }}
    </button>

    <div class="d-flex flex-wrap align-items-center gap-3">
      <div class="d-flex align-items-center gap-2">
        <label class="fw-bold mb-0">Select Status:</label>
        <select
          [(ngModel)]="selectedStatusFilter"
          (change)="onStatusFilterChange()"
          class="form-select w-auto"
        >
          <option value="All">All</option>
          <option value="Open">Open</option>
          <option value="In Progress">In Progress</option>
        </select>
      </div>
    </div>
  </div>

  <div *ngIf="showAddForm" class="card p-3 mb-3 shadow-sm">
    <div class="mb-2">
      <label class="fw-bold mb-1">Ticket Name:</label>
      <input [(ngModel)]="newTicket.title" placeholder="Enter Ticket Title" class="form-control" />
    </div>

    <div class="mb-2">
      <label class="fw-bold mb-1">Ticket Status:</label>
      <select [(ngModel)]="newTicket.status" class="form-select">
        <option value="" disabled selected hidden>Select Status</option>
        <option>Open</option>
      </select>
    </div>

    <div class="mb-2">
      <label class="fw-bold mb-1">Ticket Priority:</label>
      <select [(ngModel)]="newTicket.priority" class="form-select">
        <option value="" disabled selected hidden>Select Priority</option>
        <option>High</option>
        <option>Medium</option>
        <option>Low</option>
      </select>
    </div>

    <div class="d-flex justify-content-end gap-2">
      <button class="btn btn-success" (click)="addTicket()">Add Ticket</button>
      <button class="btn btn-secondary" (click)="cancelAdd()">Cancel</button>
    </div>
  </div>

  <div class="table-responsive">
    <table class="table table-striped table-hover align-middle">
      <thead class="table-primary">
        <tr>
          <th>Ticket Title</th>
          <th>Ticket Status</th>
          <th>Ticket Priority</th>
          <th>Ticket Created At</th>
          <th>Ticket Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let ticket of filteredTickets;let i = index">
          <td *ngIf="editingTicketId !== ticket.id">{{ ticket.title }}</td>
          <td *ngIf="editingTicketId === ticket.id">
            <input [(ngModel)]="editedTicket.title" class="form-control" />
          </td>

          <td *ngIf="editingTicketId !== ticket.id">{{ ticket.status }}</td>
          <td *ngIf="editingTicketId === ticket.id">
            <select [(ngModel)]="editedTicket.status" class="form-select">
              <option>Open</option>
              <option>In Progress</option>
              <option>Closed</option>
            </select>
          </td>

          <td *ngIf="editingTicketId !== ticket.id">{{ ticket.priority }}</td>
          <td *ngIf="editingTicketId === ticket.id">
            <select [(ngModel)]="editedTicket.priority" class="form-select">
              <option>High</option>
              <option>Medium</option>
              <option>Low</option>
            </select>
          </td>

          <td>{{ ticket.createdAt | date: 'short' }}</td>

          <td>
            <div *ngIf="editingTicketId !== ticket.id" class="d-flex gap-2">
              <button class="btn btn-sm" (click)="startEdit(ticket)">
                <i class="fa-solid fa-pen"></i>
              </button>
              <button class="btn btn-sm" (click)="deleteTicket(ticket.id)">
                <i class="fa-solid fa-trash"></i>
              </button>
            </div>

            <div *ngIf="editingTicketId === ticket.id" class="d-flex gap-2">
              <button class="btn btn-sm btn-success" (click)="saveEdit(ticket.id)">
                Save
              </button>
              <button class="btn btn-sm btn-secondary" (click)="cancelEdit()">
                Cancel
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <div *ngIf="filteredTickets.length === 0" class="text-center p-3 text-muted">
      No tickets found.
    </div>
  </div>
</div>
